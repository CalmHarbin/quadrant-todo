<template>
  <div class="drag-help-modal" :data-theme="isDark ? 'dark' : 'light'" :style="{ backgroundColor: isDark ? '#1a1a1a' : '#f5f5f5' }">
    <div class="modal-content" :style="{ backgroundColor: isDark ? '#2a2a2a' : 'white', color: isDark ? '#e0e0e0' : 'inherit' }">
      <div class="modal-header" :style="{ 
        background: isDark ? 'linear-gradient(135deg, #4a5568 0%, #2d3748 100%)' : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        borderBottomColor: isDark ? '#434343' : '#e8e8e8'
      }">
        <span>ğŸ“š ç³»ç»ŸåŠŸèƒ½è¯´æ˜</span>
        <button @click="closeModal" class="close-btn">Ã—</button>
      </div>

      <div class="modal-body">
        <div class="drag-help-content custom-scrollbar">
      <div class="help-section">
        <h3>ğŸ¯ å››è±¡é™ç®¡ç†æ–¹æ³•</h3>
        <div class="help-scenarios">
          <div class="scenario">
            <div class="scenario-icon">ğŸ”¥</div>
            <div class="scenario-content">
              <strong>é‡è¦ä¸”ç´§æ€¥</strong><br />
              éœ€è¦ç«‹å³å¤„ç†çš„äº‹æƒ…ï¼Œä¼˜å…ˆçº§æœ€é«˜
            </div>
          </div>
          <div class="scenario">
            <div class="scenario-icon">ğŸ“ˆ</div>
            <div class="scenario-content">
              <strong>é‡è¦ä¸ç´§æ€¥</strong><br />
              éœ€è¦è§„åˆ’å®‰æ’ï¼Œé•¿æœŸç›®æ ‡å’Œè®¡åˆ’
            </div>
          </div>
          <div class="scenario">
            <div class="scenario-icon">â°</div>
            <div class="scenario-content">
              <strong>ç´§æ€¥ä¸é‡è¦</strong><br />
              å¯ä»¥å§”æ‰˜æˆ–å¿«é€Ÿå¤„ç†çš„äº‹æƒ…
            </div>
          </div>
          <div class="scenario">
            <div class="scenario-icon">ğŸ˜´</div>
            <div class="scenario-content">
              <strong>ä¸é‡è¦ä¸ç´§æ€¥</strong><br />
              é—²æ—¶å¤„ç†æˆ–è€ƒè™‘åˆ é™¤çš„äº‹æƒ…
            </div>
          </div>
        </div>
      </div>

      <div class="help-section">
        <h3>âš™ï¸ åŸºæœ¬æ“ä½œ</h3>
        <div class="help-steps">
          <div class="help-step">
            <div class="step-number">1</div>
            <div class="step-content">
              <strong>æ–°å¢å¾…åŠ</strong><br />
              ç‚¹å‡»å„è±¡é™å³ä¸Šè§’çš„
              <strong>+</strong> æŒ‰é’®ï¼Œå¡«å†™æ ‡é¢˜å’Œå†…å®¹
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">2</div>
            <div class="step-content">
              <strong>ç¼–è¾‘å¾…åŠ</strong><br />
              åŒå‡»å¾…åŠå¡ç‰‡å³å¯ç¼–è¾‘ï¼Œæ”¯æŒå›¾ç‰‡ç²˜è´´
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">3</div>
            <div class="step-content">
              <strong>æ‹–æ‹½æ’åº</strong><br />
              ç›´æ¥æ‹–æ‹½å¾…åŠå¡ç‰‡å¯æ”¹å˜é¡ºåºæˆ–ç§»åŠ¨åˆ°å…¶ä»–è±¡é™
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">4</div>
            <div class="step-content">
              <strong>å®Œæˆå¾…åŠ</strong><br />
              å‹¾é€‰å¤é€‰æ¡†æ ‡è®°ä¸ºå·²å®Œæˆï¼Œ24å°æ—¶åè‡ªåŠ¨å½’æ¡£
            </div>
          </div>
        </div>
      </div>

      <div class="help-section">
        <h3>ğŸš€ é«˜çº§åŠŸèƒ½</h3>
        <div class="visual-hints">
          <div class="hint-item">
            <div class="hint-card">ğŸ“‹</div>
            <span
              ><strong>å·²å®Œæˆå¾…åŠï¼š</strong
              >æŸ¥çœ‹å’Œç®¡ç†å·²å®Œæˆçš„ä»»åŠ¡ï¼Œæ”¯æŒæ¢å¤å’Œåˆ é™¤</span
            >
          </div>
          <div class="hint-item">
            <div class="hint-card">ğŸ“</div>
            <span
              ><strong>æ•°æ®ç®¡ç†ï¼š</strong
              >å‹ç¼©åŒ…å¯¼å…¥å¯¼å‡ºã€æ•°æ®ç»Ÿè®¡å’Œæ¸…ç†</span
            >
          </div>
          <div class="hint-item">
            <div class="hint-card">âš™ï¸</div>
            <span
              ><strong>ç³»ç»Ÿè®¾ç½®ï¼š</strong
              >æ›´æ”¹æ•°æ®å­˜å‚¨ç›®å½•å’Œåº”ç”¨é…ç½®</span
            >
          </div>
          <div class="hint-item">
            <div class="hint-card">ğŸŒ™</div>
            <span
              ><strong>ä¸»é¢˜åˆ‡æ¢ï¼š</strong
              >ç‚¹å‡»æœˆäº®/å¤ªé˜³å›¾æ ‡åˆ‡æ¢æ·±è‰²æ¨¡å¼</span
            >
          </div>
          <div class="hint-item">
            <div class="hint-card">ğŸ–¼ï¸</div>
            <span
              ><strong>å›¾ç‰‡å¤„ç†ï¼š</strong
              >æ”¯æŒå›¾ç‰‡é¢„è§ˆã€è°ƒæ•´å¤§å°ã€å¤åˆ¶ç­‰åŠŸèƒ½</span
            >
          </div>
          <div class="hint-item">
            <div class="hint-card">ğŸªŸ</div>
            <span
              ><strong>çª—å£æ¨¡å¼ï¼š</strong
              >æ”¯æŒæ¡Œé¢å°ç»„ä»¶æ¨¡å¼å’Œæ™®é€šçª—å£æ¨¡å¼åˆ‡æ¢</span
            >
          </div>
        </div>
      </div>

      <div class="help-section">
        <h3>ğŸ–¼ï¸ å›¾ç‰‡å¤„ç†åŠŸèƒ½</h3>
        <div class="help-steps">
          <div class="help-step">
            <div class="step-number">1</div>
            <div class="step-content">
              <strong>å›¾ç‰‡ç²˜è´´</strong><br />
              åœ¨ç¼–è¾‘æ¡†ä¸­æŒ‰ Ctrl+V ç›´æ¥ç²˜è´´å›¾ç‰‡
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">2</div>
            <div class="step-content">
              <strong>å›¾ç‰‡è°ƒæ•´</strong><br />
              ç‚¹å‡»å›¾ç‰‡æ˜¾ç¤ºè°ƒæ•´æ‰‹æŸ„ï¼Œæ‹–æ‹½è°ƒæ•´å¤§å°ï¼ˆæŒ‰Shiftä¿æŒå®½é«˜æ¯”ï¼‰
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">3</div>
            <div class="step-content">
              <strong>å›¾ç‰‡é¢„è§ˆ</strong><br />
              åŒå‡»å›¾ç‰‡æ‰“å¼€å…¨å±é¢„è§ˆï¼Œæ”¯æŒç¼©æ”¾ã€æ‹–æ‹½ã€æ—‹è½¬
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">4</div>
            <div class="step-content">
              <strong>å›¾ç‰‡å¤åˆ¶</strong><br />
              å³é”®å›¾ç‰‡å¯å¤åˆ¶åˆ°å‰ªè´´æ¿
            </div>
          </div>
        </div>
      </div>

      <div class="help-section">
        <h3>ğŸªŸ çª—å£æ¨¡å¼åŠŸèƒ½</h3>
        <div class="help-steps">
          <div class="help-step">
            <div class="step-number">1</div>
            <div class="step-content">
              <strong>æ¡Œé¢å°ç»„ä»¶æ¨¡å¼</strong><br />
              ç‚¹å‡»å³ä¸Šè§’"â‹¯"æŒ‰é’®é€‰æ‹©"åˆ‡æ¢åˆ°æ¡Œé¢å°ç»„ä»¶"
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">2</div>
            <div class="step-content">
              <strong>å›ºå®šåˆ°æ¡Œé¢</strong><br />
              åœ¨å°ç»„ä»¶æ¨¡å¼ä¸‹å¯å›ºå®šåˆ°æ¡Œé¢ï¼Œå§‹ç»ˆæ˜¾ç¤º
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">3</div>
            <div class="step-content">
              <strong>çª—å£æŠ˜å </strong><br />
              ç‚¹å‡»æ ‡é¢˜æ â¬†ï¸æŒ‰é’®å¯æŠ˜å çª—å£ï¼Œåªæ˜¾ç¤ºæ ‡é¢˜æ 
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">4</div>
            <div class="step-content">
              <strong>å¿«æ·é”®</strong><br />
              Ctrl+Shift+T æ¢å¤éšè—çš„çª—å£
            </div>
          </div>
        </div>
      </div>

      <div class="help-section">
        <h3>ğŸ’¾ æ•°æ®ç®¡ç†åŠŸèƒ½</h3>
        <div class="help-steps">
          <div class="help-step">
            <div class="step-number">1</div>
            <div class="step-content">
              <strong>å‹ç¼©åŒ…å¯¼å‡º</strong><br />
              å¯¼å‡ºåŒ…å«æ•°æ®å’Œå›¾ç‰‡çš„å®Œæ•´å‹ç¼©åŒ…
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">2</div>
            <div class="step-content">
              <strong>å‹ç¼©åŒ…å¯¼å…¥</strong><br />
              ä»å‹ç¼©åŒ…æ¢å¤å®Œæ•´æ•°æ®ï¼ŒåŒ…æ‹¬å›¾ç‰‡
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">3</div>
            <div class="step-content">
              <strong>æ•°æ®ç»Ÿè®¡</strong><br />
              æŸ¥çœ‹å„è±¡é™å¾…åŠæ•°é‡ã€å®Œæˆæƒ…å†µç­‰ç»Ÿè®¡ä¿¡æ¯
            </div>
          </div>
          <div class="help-step">
            <div class="step-number">4</div>
            <div class="step-content">
              <strong>å­˜å‚¨ç›®å½•ç®¡ç†</strong><br />
              è‡ªå®šä¹‰æ•°æ®å­˜å‚¨ä½ç½®ï¼Œä¾¿äºå¤‡ä»½å’Œè¿ç§»
            </div>
          </div>
        </div>
      </div>

      <div class="help-section">
        <h3>å®ç”¨æŠ€å·§</h3>
        <ul class="tips-list">
          <li>æ–°å¢çš„å¾…åŠä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨è±¡é™é¡¶éƒ¨</li>
          <li>æ‹–æ‹½æ—¶é è¿‘åˆ—è¡¨è¾¹ç¼˜ä¼šè‡ªåŠ¨æ»šåŠ¨</li>
          <li>åœ¨å¾…åŠå†…å®¹ä¸­å¯ä»¥ç›´æ¥ç²˜è´´å›¾ç‰‡</li>
          <li>ä½¿ç”¨å³ä¸Šè§’"ç§»åŠ¨"æŒ‰é’®å¯å¿«é€Ÿè½¬ç§»è±¡é™</li>
          <li>å·²å®Œæˆçš„å¾…åŠåœ¨é¡µé¢ä¸Šæ˜¾ç¤º24å°æ—¶åè‡ªåŠ¨å½’æ¡£</li>
          <li>æ”¯æŒæ•°æ®å¯¼å…¥å¯¼å‡ºï¼Œæ–¹ä¾¿å¤‡ä»½å’Œè¿ç§»</li>
          <li>åŒå‡»å›¾ç‰‡å¯å…¨å±é¢„è§ˆï¼Œæ”¯æŒç¼©æ”¾å’Œæ‹–æ‹½</li>
          <li>æ¡Œé¢å°ç»„ä»¶æ¨¡å¼é€‚åˆä½œä¸ºæ¡Œé¢ä¾¿ç­¾ä½¿ç”¨</li>
          <li>çª—å£å¯æŠ˜å ä¸ºæ ‡é¢˜æ ï¼ŒèŠ‚çœæ¡Œé¢ç©ºé—´</li>
          <li>å›¾ç‰‡æ”¯æŒå³é”®å¤åˆ¶ï¼Œæ–¹ä¾¿åœ¨å…¶ä»–åº”ç”¨ä¸­ä½¿ç”¨</li>
        </ul>
      </div>
        </div>
      </div>

      <div class="modal-footer" :style="{ 
        backgroundColor: isDark ? '#333333' : '#fafafa',
        borderTopColor: isDark ? '#434343' : '#e8e8e8'
      }">
        <button @click="closeModal" class="modal-btn" :style="{
          backgroundColor: isDark ? '#404040' : '#ffffff',
          color: isDark ? '#e0e0e0' : '#333333',
          borderColor: isDark ? '#555555' : '#d9d9d9'
        }">æˆ‘çŸ¥é“äº†</button>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted } from 'vue'

// å®šä¹‰emits
const emit = defineEmits<{
  (e: 'close'): void
}>()

// ä¸»é¢˜çŠ¶æ€
const isDark = ref(false)

// å…³é—­æ¨¡æ€æ¡†
const closeModal = () => {
  // å¦‚æœåœ¨ç‹¬ç«‹çª—å£ä¸­ï¼Œç›´æ¥å…³é—­çª—å£
  if (typeof window !== 'undefined' && window.electronAPI) {
    window.electronAPI.closeModalWindow()
  } else {
    // å¦‚æœåœ¨æ™®é€šé¡µé¢ä¸­ï¼Œå‘å‡ºå…³é—­äº‹ä»¶
    emit('close')
  }
}

// ç›‘å¬ä¸»é¢˜å˜åŒ–
const handleStorageChange = (e: StorageEvent) => {
  if (e.key === 'theme') {
    isDark.value = e.newValue === 'dark'
  }
}

// è½®è¯¢æ£€æŸ¥ä¸»é¢˜å˜åŒ–ï¼ˆç”¨äºç‹¬ç«‹çª—å£æ¨¡å¼ï¼‰
let themeCheckInterval: ReturnType<typeof setInterval> | null = null

// åˆå§‹åŒ–ä¸»é¢˜
onMounted(() => {
  const savedTheme = localStorage.getItem('theme')
  isDark.value = savedTheme === 'dark'
  
  // ç›‘å¬localStorageå˜åŒ–
  window.addEventListener('storage', handleStorageChange)
  
  // è½®è¯¢æ£€æŸ¥ä¸»é¢˜å˜åŒ–ï¼ˆæ¯500msæ£€æŸ¥ä¸€æ¬¡ï¼‰
  themeCheckInterval = setInterval(() => {
    const currentTheme = localStorage.getItem('theme')
    if (currentTheme === 'dark' && !isDark.value) {
      isDark.value = true
    } else if (currentTheme === 'light' && isDark.value) {
      isDark.value = false
    }
  }, 500)
})

onUnmounted(() => {
  window.removeEventListener('storage', handleStorageChange)
  if (themeCheckInterval) {
    clearInterval(themeCheckInterval)
  }
})
</script>

<style scoped>
/* ç³»ç»ŸåŠŸèƒ½è¯´æ˜æ¨¡æ€æ¡†åŸºç¡€æ ·å¼ */
.drag-help-modal {
  width: 100vw;
  height: 100vh;
  background: #f5f5f5;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

/* æš—é»‘ä¸»é¢˜æ ·å¼ - ä½¿ç”¨æ›´å…·ä½“çš„é€‰æ‹©å™¨ */
.drag-help-modal[data-theme='dark'] {
  background: #1a1a1a !important;
}

.drag-help-modal .modal-content {
  width: 100%;
  height: 100%;
  background: white;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* æ·±è‰²ä¸»é¢˜æ¨¡æ€æ¡†å†…å®¹ */
.drag-help-modal[data-theme='dark'] .modal-content {
  background: #2a2a2a !important;
  color: #e0e0e0 !important;
}

.drag-help-modal .modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #e8e8e8;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

/* æ·±è‰²ä¸»é¢˜å¤´éƒ¨ */
.drag-help-modal[data-theme='dark'] .modal-header {
  border-bottom-color: #434343 !important;
  background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%) !important;
}

.drag-help-modal .modal-header span {
  font-size: 16px;
  font-weight: 600;
  color: white;
}

.drag-help-modal .close-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: white;
  padding: 4px;
  border-radius: 4px;
  transition: background-color 0.2s;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.drag-help-modal .close-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

.drag-help-modal .modal-body {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  min-height: 0;
  position: relative;
}

.drag-help-modal .modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding: 16px 20px;
  border-top: 1px solid #e8e8e8;
  background: #fafafa;
}

/* æ·±è‰²ä¸»é¢˜åº•éƒ¨ */
.drag-help-modal[data-theme='dark'] .modal-footer {
  border-top-color: #434343 !important;
  background: #333333 !important;
}

.drag-help-modal .modal-btn {
  padding: 8px 16px;
  border: 1px solid #d9d9d9;
  border-radius: 4px;
  background: white;
  color: #333;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
}

/* æ·±è‰²ä¸»é¢˜æŒ‰é’® */
.drag-help-modal[data-theme='dark'] .modal-btn {
  background: #404040 !important;
  border-color: #555555 !important;
  color: #e0e0e0 !important;
}

.drag-help-modal .modal-btn:hover {
  background: #f5f5f5;
  border-color: #007bff;
}

/* æ·±è‰²ä¸»é¢˜æŒ‰é’®æ‚¬åœ */
.drag-help-modal[data-theme='dark'] .modal-btn:hover {
  background: #555555 !important;
  border-color: #007bff !important;
}

/* ç³»ç»ŸåŠŸèƒ½è¯´æ˜å†…å®¹æ ·å¼ */
.drag-help-content {
  padding: 20px;
  flex: 1;
  overflow-y: auto;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  box-sizing: border-box;
  line-height: 1.6;
}

.help-section {
  margin-bottom: 32px;
}

.help-section:last-child {
  margin-bottom: 0;
}

.drag-help-content .help-section:last-child {
  margin-bottom: 0;
}

.help-section h3 {
  margin: 0 0 20px 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--text-color);
  border-bottom: 2px solid #40a9ff;
  padding-bottom: 12px;
}

.help-steps {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.help-step {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  padding: 20px;
  background: rgba(64, 169, 255, 0.05);
  border-radius: 8px;
  border-left: 4px solid #40a9ff;
}

.step-number {
  background: #40a9ff;
  color: white;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
  flex-shrink: 0;
}

.step-content {
  flex: 1;
  font-size: 14px;
}

.help-scenarios {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
}

.scenario {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px;
  background: rgba(0, 0, 0, 0.02);
  border-radius: 8px;
  border: 1px solid var(--border-color);
}

.scenario-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.scenario-content {
  font-size: 14px;
}

.visual-hints {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.hint-item {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
  background: rgba(0, 0, 0, 0.01);
  border-radius: 6px;
}

.hint-indicator {
  width: 60px;
  height: 3px;
  border-radius: 2px;
}

.drop-indicator-demo {
  background: linear-gradient(90deg, #40a9ff, #1890ff);
  animation: pulse 1s ease-in-out infinite alternate;
  box-shadow: 0 0 6px rgba(64, 169, 255, 0.4);
}

.hint-card {
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
}

.dragging-demo {
  background: rgba(64, 169, 255, 0.1);
  border: 2px solid #40a9ff;
  opacity: 0.4;
  transform: scale(0.98);
}

.pressed-demo {
  background: rgba(64, 169, 255, 0.15);
  border: 2px solid #40a9ff;
  transform: scale(1.03);
  box-shadow: 0 4px 12px rgba(64, 169, 255, 0.3);
}

.tips-list {
  margin: 0;
  padding-left: 20px;
  padding-bottom: 0;
}

.tips-list li {
  margin-bottom: 8px;
  font-size: 14px;
  color: var(--text-color);
}

.tips-list li:last-child {
  margin-bottom: 0;
}

.drag-help-modal[data-theme='dark'] .help-step {
  background: rgba(64, 169, 255, 0.1) !important;
}

.drag-help-modal[data-theme='dark'] .scenario {
  background: rgba(255, 255, 255, 0.02) !important;
}

.drag-help-modal[data-theme='dark'] .hint-item {
  background: rgba(255, 255, 255, 0.01) !important;
}

</style>
